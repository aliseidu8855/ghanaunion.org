{% extends "admin/base_site.html" %}
{% load static %}

{% block extrastyle %}
    {{ block.super }}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .metric-card {
            border-left: 5px solid;
        }
        .border-primary { border-color: #0d6efd !important; }
        .border-warning { border-color: #ffc107 !important; }
    </style>
{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} app-dashboard{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">Home</a> &rsaquo; Dashboard
</div>
{% endblock %}

{% block content %}
<div id="content-main">
    <h1>{{ title }}</h1>
    
    <!-- Key Metrics -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card metric-card border-primary shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-primary">Total Members</h5>
                    <p class="card-text fs-2 fw-bold">{{ total_members }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card metric-card border-warning shadow-sm">
                <div class="card-body">
                    <h5 class="card-title text-warning">Pending Approval</h5>
                    <p class="card-text fs-2 fw-bold">{{ pending_approval }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Charts -->
    <div class="row">
        <div class="col-lg-12 mb-4">
            <div class="card shadow-sm">
                <div class="card-header">Member Growth Over Time</div>
                <div class="card-body"><canvas id="memberGrowthChart"></canvas></div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header">Membership Tier Distribution</div>
                <div class="card-body"><canvas id="tierDistributionChart"></canvas></div>
            </div>
        </div>
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-header">Top 10 Member Locations</div>
                <div class="card-body"><canvas id="geoDistributionChart"></canvas></div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Member Growth Chart
    const growthCtx = document.getElementById('memberGrowthChart').getContext('2d');
    new Chart(growthCtx, {
        type: 'line',
        data: {
            labels: {{ growth_labels|safe }},
            datasets: [{
                label: 'New Members',
                data: {{ growth_data|safe }},
                borderColor: 'rgba(0, 107, 63, 1)',
                backgroundColor: 'rgba(0, 107, 63, 0.2)',
                fill: true,
                tension: 0.1
            }]
        }
    });

    // Tier Distribution Chart
    const tierCtx = document.getElementById('tierDistributionChart').getContext('2d');
    new Chart(tierCtx, {
        type: 'pie',
        data: {
            labels: {{ tier_labels|safe }},
            datasets: [{
                label: 'Members',
                data: {{ tier_data|safe }},
                backgroundColor: ['#006B3F', '#FCD116', '#CE1126', '#2C2C2C']
            }]
        }
    });

    // Geographic Distribution Chart
    const geoCtx = document.getElementById('geoDistributionChart').getContext('2d');
    new Chart(geoCtx, {
        type: 'bar',
        data: {
            labels: {{ geo_labels|safe }},
            datasets: [{
                label: 'Number of Members',
                data: {{ geo_data|safe }},
                backgroundColor: 'rgba(44, 44, 44, 0.8)'
            }]
        },
        options: { indexAxis: 'y' }
    });
});
</script>
{% endblock %}